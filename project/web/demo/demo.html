<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIToEarnæ’ä»¶ Web API Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .content {
      padding: 30px;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: #667eea;
      margin-right: 10px;
      border-radius: 2px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .radio-group {
      display: flex;
      gap: 15px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: auto;
      margin-right: 5px;
      cursor: pointer;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type="file"] {
      cursor: pointer;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #333;
      margin-bottom: 10px;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #e0e0e0;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .progress-container {
      margin-top: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      display: none;
    }

    .progress-container.show {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: #e0e0e0;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
    }

    .progress-info {
      font-size: 14px;
      color: #666;
    }

    .result-container {
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .result-container.show {
      display: block;
    }

    .result-container.success {
      background: #e8f5e9;
      border: 2px solid #4caf50;
    }

    .result-container.error {
      background: #ffebee;
      border: 2px solid #f44336;
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .result-container.success .result-title {
      color: #2e7d32;
    }

    .result-container.error .result-title {
      color: #c62828;
    }

    .result-item {
      margin-bottom: 8px;
      font-size: 14px;
    }

    .result-item strong {
      display: inline-block;
      min-width: 80px;
    }

    .result-link {
      color: #667eea;
      text-decoration: none;
      word-break: break-all;
    }

    .result-link:hover {
      text-decoration: underline;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .status-badge.ready {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .status-badge.error {
      background: #ffebee;
      color: #c62828;
    }

    .tips {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #666;
      margin-top: 15px;
    }

    .file-preview {
      margin-top: 10px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 4px;
      font-size: 13px;
      color: #666;
      display: none;
    }

    .file-preview.show {
      display: block;
    }

    .account-info {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      display: none;
    }

    .account-info.show {
      display: block;
    }

    .account-info-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .account-info-item img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    @media (max-width: 768px) {
      .container {
        border-radius: 0;
      }
      
      .content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸš€ AIToEarnæ’ä»¶ Web API Demo</h1>
      <p>ä½“éªŒæµè§ˆå™¨æ’ä»¶çš„ç™»å½•å’Œå‘å¸ƒåŠŸèƒ½</p>
    </div>

    <div class="content">
      <!-- æ’ä»¶çŠ¶æ€ -->
      <div class="section">
        <div class="section-title">æ’ä»¶çŠ¶æ€</div>
        <div id="pluginStatus">
          <span class="status-badge error">æ£€æµ‹ä¸­...</span>
        </div>
      </div>

      <!-- ç™»å½•åŠŸèƒ½ -->
      <div class="section">
        <div class="section-title">1ï¸âƒ£ ç™»å½•å¹³å°</div>
        <div class="form-group">
          <label>é€‰æ‹©å¹³å°</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="loginPlatform" value="douyin" checked>
              <span>æŠ–éŸ³</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="loginPlatform" value="xhs">
              <span>å°çº¢ä¹¦</span>
            </label>
          </div>
        </div>
        <button class="btn btn-secondary" onclick="handleLogin()" id="loginBtn">
          ç™»å½•
        </button>
        <div class="account-info" id="accountInfo"></div>
      </div>

      <!-- å‘å¸ƒåŠŸèƒ½ -->
      <div class="section">
        <div class="section-title">2ï¸âƒ£ å‘å¸ƒå†…å®¹</div>

        <!-- å¹³å°é€‰æ‹© -->
        <div class="form-group">
          <label>å‘å¸ƒå¹³å°</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="platform" value="douyin" checked>
              <span>æŠ–éŸ³</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="platform" value="xhs">
              <span>å°çº¢ä¹¦</span>
            </label>
          </div>
        </div>

        <!-- å†…å®¹ç±»å‹ -->
        <div class="form-group">
          <label>å†…å®¹ç±»å‹</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="contentType" value="video" checked onchange="toggleContentType()">
              <span>è§†é¢‘</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="contentType" value="image" onchange="toggleContentType()">
              <span>å›¾æ–‡</span>
            </label>
          </div>
        </div>

        <!-- è§†é¢‘ä¸Šä¼  -->
        <div id="videoFields">
          <div class="form-group">
            <label>ä¸Šä¼ è§†é¢‘</label>
            <input type="file" id="videoFile" accept="video/*" onchange="handleFileSelect('video')">
            <div class="file-preview" id="videoPreview"></div>
          </div>
          <div class="form-group">
            <label>ä¸Šä¼ å°é¢</label>
            <input type="file" id="coverFile" accept="image/*" onchange="handleFileSelect('cover')">
            <div class="file-preview" id="coverPreview"></div>
          </div>
        </div>

        <!-- å›¾ç‰‡ä¸Šä¼  -->
        <div id="imageFields" style="display: none;">
          <div class="form-group">
            <label>ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰</label>
            <input type="file" id="imageFiles" accept="image/*" multiple onchange="handleFileSelect('images')">
            <div class="file-preview" id="imagesPreview"></div>
          </div>
        </div>

        <!-- æ ‡é¢˜ -->
        <div class="form-group">
          <label>æ ‡é¢˜</label>
          <input type="text" id="title" placeholder="è¯·è¾“å…¥æ ‡é¢˜" maxlength="100">
        </div>

        <!-- æè¿° -->
        <div class="form-group">
          <label>æè¿°</label>
          <textarea id="desc" placeholder="è¯·è¾“å…¥æè¿°å†…å®¹" maxlength="2000"></textarea>
        </div>

        <!-- è¯é¢˜ -->
        <div class="form-group">
          <label>è¯é¢˜æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
          <input type="text" id="topics" placeholder="ä¾‹å¦‚: ç”Ÿæ´»,è®°å½•,ç¾å¥½">
        </div>

        <!-- å‘å¸ƒæŒ‰é’® -->
        <button class="btn btn-primary" onclick="handlePublish()" id="publishBtn">
          å¼€å§‹å‘å¸ƒ
        </button>

        <!-- æç¤º -->
        <div class="tips">
          ğŸ’¡ æç¤ºï¼šæ”¯æŒFileå¯¹è±¡å’ŒURLä¸¤ç§æ–¹å¼ï¼Œæœ¬Demoä½¿ç”¨Fileå¯¹è±¡ä¸Šä¼ 
        </div>
      </div>

      <!-- è¿›åº¦æ˜¾ç¤º -->
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
        </div>
        <div class="progress-info" id="progressInfo">å‡†å¤‡ä¸­...</div>
      </div>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div class="result-container" id="resultContainer">
        <div class="result-title" id="resultTitle"></div>
        <div id="resultContent"></div>
      </div>
    </div>
  </div>

  <script>
    // æ£€æµ‹æ’ä»¶æ˜¯å¦å®‰è£…
    function checkPlugin() {
      const statusEl = document.getElementById('pluginStatus');
      if (window.AIToEarnPlugin) {
        statusEl.innerHTML = '<span class="status-badge ready">âœ“ æ’ä»¶å·²å°±ç»ª</span>';
        console.log('AIToEarnæ’ä»¶å·²åŠ è½½');
      } else {
        statusEl.innerHTML = '<span class="status-badge error">âœ— æ’ä»¶æœªå®‰è£…</span>';
        setTimeout(checkPlugin, 500); // ç»§ç»­æ£€æµ‹
      }
    }

    // åˆå§‹åŒ–
    checkPlugin();

    // åˆ‡æ¢å†…å®¹ç±»å‹
    function toggleContentType() {
      const contentType = document.querySelector('input[name="contentType"]:checked').value;
      const videoFields = document.getElementById('videoFields');
      const imageFields = document.getElementById('imageFields');
      
      if (contentType === 'video') {
        videoFields.style.display = 'block';
        imageFields.style.display = 'none';
      } else {
        videoFields.style.display = 'none';
        imageFields.style.display = 'block';
      }
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelect(type) {
      if (type === 'video') {
        const file = document.getElementById('videoFile').files[0];
        const preview = document.getElementById('videoPreview');
        if (file) {
          preview.textContent = `å·²é€‰æ‹©: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
          preview.classList.add('show');
        }
      } else if (type === 'cover') {
        const file = document.getElementById('coverFile').files[0];
        const preview = document.getElementById('coverPreview');
        if (file) {
          preview.textContent = `å·²é€‰æ‹©: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
          preview.classList.add('show');
        }
      } else if (type === 'images') {
        const files = document.getElementById('imageFiles').files;
        const preview = document.getElementById('imagesPreview');
        if (files.length > 0) {
          const fileList = Array.from(files).map(f => 
            `${f.name} (${(f.size / 1024).toFixed(2)} KB)`
          ).join(', ');
          preview.textContent = `å·²é€‰æ‹© ${files.length} å¼ å›¾ç‰‡: ${fileList}`;
          preview.classList.add('show');
        }
      }
    }

    // å¤„ç†ç™»å½•
    async function handleLogin() {
      if (!window.AIToEarnPlugin) {
        alert('è¯·å…ˆå®‰è£…AIToEarnæµè§ˆå™¨æ’ä»¶ï¼');
        return;
      }

      // å¹³å°å€¼ï¼š'douyin' æˆ– 'xhs'ï¼ˆå¯¹åº” PlatType æšä¸¾ï¼‰
      const platform = document.querySelector('input[name="loginPlatform"]:checked').value;
      const loginBtn = document.getElementById('loginBtn');
      const accountInfo = document.getElementById('accountInfo');

      loginBtn.disabled = true;
      loginBtn.textContent = 'ç™»å½•ä¸­...';
      accountInfo.classList.remove('show');

      try {
        const result = await window.AIToEarnPlugin.login(platform);
        console.log('ç™»å½•æˆåŠŸ:', result);

        // æ˜¾ç¤ºè´¦å·ä¿¡æ¯
        accountInfo.innerHTML = `
          <div class="account-info-item">
            <img src="${result.avatar}" alt="å¤´åƒ">
            <div>
              <div><strong>${result.nickname}</strong></div>
              <div style="font-size: 12px; color: #999;">
                ç²‰ä¸: ${result.fansCount || 0} | UID: ${result.uid}
              </div>
            </div>
          </div>
        `;
        accountInfo.classList.add('show');
        
        alert('ç™»å½•æˆåŠŸï¼æ˜µç§°: ' + result.nickname);
      } catch (error) {
        console.error('ç™»å½•å¤±è´¥:', error);
        alert('ç™»å½•å¤±è´¥: ' + error.message);
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'ç™»å½•';
      }
    }

    // å¤„ç†å‘å¸ƒ
    async function handlePublish() {
      if (!window.AIToEarnPlugin) {
        alert('è¯·å…ˆå®‰è£…AIToEarnæµè§ˆå™¨æ’ä»¶ï¼');
        return;
      }

      // è·å–è¡¨å•æ•°æ®
      // å¹³å°å€¼ï¼š'douyin' æˆ– 'xhs'ï¼ˆå¯¹åº” PlatType æšä¸¾ï¼‰
      const platform = document.querySelector('input[name="platform"]:checked').value;
      const contentType = document.querySelector('input[name="contentType"]:checked').value;
      const title = document.getElementById('title').value;
      const desc = document.getElementById('desc').value;
      const topicsInput = document.getElementById('topics').value;
      const topics = topicsInput ? topicsInput.split(',').map(t => t.trim()).filter(t => t) : [];

      // éªŒè¯å¿…å¡«é¡¹
      if (!title) {
        alert('è¯·è¾“å…¥æ ‡é¢˜ï¼');
        return;
      }

      // å‡†å¤‡å‘å¸ƒå‚æ•°
      const params = {
        platform: platform,
        type: contentType,
        title: title,
        desc: desc,
        topics: topics,
        visibility: 'public',
      };

      // å¤„ç†æ–‡ä»¶
      if (contentType === 'video') {
        const videoFile = document.getElementById('videoFile').files[0];
        const coverFile = document.getElementById('coverFile').files[0];
        
        if (!videoFile) {
          alert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼');
          return;
        }
        if (!coverFile) {
          alert('è¯·é€‰æ‹©å°é¢å›¾ç‰‡ï¼');
          return;
        }
        
        params.video = videoFile;
        params.cover = coverFile;
      } else {
        const imageFiles = document.getElementById('imageFiles').files;
        
        if (imageFiles.length === 0) {
          alert('è¯·è‡³å°‘é€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼');
          return;
        }
        
        params.images = Array.from(imageFiles);
      }

      // UIçŠ¶æ€
      const publishBtn = document.getElementById('publishBtn');
      const progressContainer = document.getElementById('progressContainer');
      const resultContainer = document.getElementById('resultContainer');
      
      publishBtn.disabled = true;
      publishBtn.textContent = 'å‘å¸ƒä¸­...';
      progressContainer.classList.add('show');
      resultContainer.classList.remove('show');

      try {
        const result = await window.AIToEarnPlugin.publish(params, (progress) => {
          // æ›´æ–°è¿›åº¦
          const progressFill = document.getElementById('progressFill');
          const progressInfo = document.getElementById('progressInfo');
          
          progressFill.style.width = progress.progress + '%';
          progressFill.textContent = Math.round(progress.progress) + '%';
          
          const stageNames = {
            'download': 'ä¸‹è½½èµ„æº',
            'upload': 'ä¸Šä¼ æ–‡ä»¶',
            'publish': 'å‘å¸ƒä¸­',
            'complete': 'å®Œæˆ',
            'error': 'é”™è¯¯'
          };
          
          progressInfo.textContent = `${stageNames[progress.stage] || progress.stage}: ${progress.message || ''}`;
        });

        console.log('å‘å¸ƒæˆåŠŸ:', result);

        // æ˜¾ç¤ºæˆåŠŸç»“æœ
        resultContainer.className = 'result-container success show';
        document.getElementById('resultTitle').textContent = 'âœ“ å‘å¸ƒæˆåŠŸï¼';
        document.getElementById('resultContent').innerHTML = `
          <div class="result-item"><strong>ä½œå“ID:</strong> ${result.workId || 'æ— '}</div>
          <div class="result-item">
            <strong>åˆ†äº«é“¾æ¥:</strong> 
            ${result.shareLink 
              ? `<a href="${result.shareLink}" target="_blank" class="result-link">${result.shareLink}</a>`
              : 'æ— '}
          </div>
          <div class="result-item"><strong>å‘å¸ƒæ—¶é—´:</strong> ${new Date(result.publishTime).toLocaleString()}</div>
        `;
      } catch (error) {
        console.error('å‘å¸ƒå¤±è´¥:', error);

        // æ˜¾ç¤ºé”™è¯¯ç»“æœ
        resultContainer.className = 'result-container error show';
        document.getElementById('resultTitle').textContent = 'âœ— å‘å¸ƒå¤±è´¥';
        document.getElementById('resultContent').innerHTML = `
          <div class="result-item">${error.message}</div>
        `;
      } finally {
        publishBtn.disabled = false;
        publishBtn.textContent = 'å¼€å§‹å‘å¸ƒ';
      }
    }
  </script>
</body>
</html>
